<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Î§ÏÎ¿Î½Î¿Î£Ï…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± â€“ Î Î±Î¹Ï‡Î½Î¯Î´Î¹ 4 Î–Ï‰Î½ÏÎ½</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --text:#eaf0ff;
      --muted:#b8c3e6;
      --border:rgba(255,255,255,.14);
      --shadow: 0 14px 40px rgba(0,0,0,.42);
      --radius:22px;
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
      --accent:#5a78ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(90,120,255,.25), transparent 55%),
        radial-gradient(900px 700px at 80% 20%, rgba(255,120,210,.18), transparent 55%),
        radial-gradient(900px 700px at 60% 90%, rgba(0,255,200,.12), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    header{
      display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;
      margin-bottom:14px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:46px;height:46px;border-radius:16px;
      background: conic-gradient(from 180deg,
        #FFD400, #FF8A00, #FF4FD8, #22C55E, #5AD7FF, #A78BFA,
        #D1D5DB, #6B7280, #1F3B88, #A16207, #EF4444, #111827, #7C3AED, #FFFFFF);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.18);
    }
    h1{font-size:18px;margin:0}
    .sub{color:var(--muted);font-size:12px;margin-top:2px;line-height:1.3}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--border);
      background: rgba(0,0,0,.12);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .bd{padding:14px}
    .small{font-size:12px;color:var(--muted)}
    .btnbar{display:flex;flex-wrap:wrap;gap:8px}
    button{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-size:13px;
      transition:.15s transform,.15s background;
      user-select:none;
    }
    button:hover{transform:translateY(-1px); background: rgba(255,255,255,.10);}
    button.primary{background: linear-gradient(180deg, rgba(90,120,255,.35), rgba(90,120,255,.12));}
    button.good{background: linear-gradient(180deg, rgba(34,197,94,.35), rgba(34,197,94,.12));}
    button.bad{background: linear-gradient(180deg, rgba(239,68,68,.35), rgba(239,68,68,.12));}

    /* Zones */
    .zones{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      margin-bottom:12px;
    }
    @media (max-width: 900px){
      .zones{grid-template-columns: repeat(2, 1fr);}
    }
    .zone{
      border:1px solid var(--border);
      border-radius:18px;
      padding:12px;
      background: rgba(0,0,0,.18);
      cursor:pointer;
      transition:.15s transform,.15s background;
      position:relative;
      min-height:86px;
    }
    .zone:hover{transform:translateY(-2px); background: rgba(255,255,255,.07);}
    .zone.active{outline:3px solid rgba(90,120,255,.55);}
    .zone-title{font-weight:900;font-size:16px}
    .zone-time{font-size:12px;color:var(--muted);margin-top:3px}
    .zone-mini{
      margin-top:10px;
      display:flex;align-items:center;gap:8px;flex-wrap:wrap;
      font-size:12px;color:var(--muted);
    }
    .chip{
      display:inline-flex;align-items:center;gap:7px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      padding:6px 10px;
      border-radius:999px;
      font-weight:700;
      color:var(--text);
    }
    .dot{width:14px;height:14px;border-radius:999px;border:1px solid rgba(255,255,255,.40)}

    /* Game layout */
    .game{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
    }
    @media (max-width: 980px){
      .game{grid-template-columns:1fr}
    }

    /* Wheel (pie) */
    .wheel-wrap{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .wheel-card{
      border:1px solid var(--border);
      border-radius:22px;
      background: rgba(0,0,0,.18);
      padding:14px;
    }
    .wheel-row{
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:14px;
      align-items:center;
    }
    @media (max-width: 760px){
      .wheel-row{grid-template-columns:1fr}
    }

    .wheel{
      width:280px;height:280px;border-radius:50%;
      border:2px solid rgba(255,255,255,.18);
      box-shadow: var(--shadow);
      position:relative;
      margin:0 auto;
      overflow:hidden;
      background:
        conic-gradient(
          #FFD400 0deg 25deg,
          #FF8A00 25deg 50deg,
          #FF4FD8 50deg 75deg,
          #22C55E 75deg 100deg,
          #5AD7FF 100deg 125deg,
          #A78BFA 125deg 150deg,
          #D1D5DB 150deg 175deg,
          #6B7280 175deg 200deg,
          #1F3B88 200deg 225deg,
          #A16207 225deg 250deg,
          #EF4444 250deg 275deg,
          #111827 275deg 300deg,
          #7C3AED 300deg 325deg,
          #FFFFFF 325deg 360deg
        );
    }
    .wheel::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(circle at center, rgba(0,0,0,.0) 0 62%, rgba(0,0,0,.35) 64% 100%);
      pointer-events:none;
    }
    .wheel-center{
      position:absolute; left:50%; top:50%;
      transform:translate(-50%,-50%);
      width:150px;height:150px;border-radius:50%;
      background: rgba(10,16,32,.92);
      border:2px solid rgba(255,255,255,.16);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      text-align:center;
      padding:10px;
    }
    .center-label{
      font-size:12px;color:var(--muted);
      font-weight:800;
      margin-bottom:6px;
    }
    .center-emotion{
      font-size:16px;
      font-weight:1000;
      line-height:1.15;
    }
    .center-sub{
      margin-top:8px;
      font-size:12px;color:var(--muted);
      font-weight:700;
    }
    .pointer{
      position:absolute; top:-10px; left:50%;
      transform:translateX(-50%);
      width:0;height:0;
      border-left:14px solid transparent;
      border-right:14px solid transparent;
      border-bottom:20px solid rgba(255,255,255,.85);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.35));
    }

    /* Big, kid-friendly emotion buttons */
    .emo-list{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width: 560px){
      .emo-list{grid-template-columns:1fr}
    }
    .emo-btn{
      display:flex;align-items:center;gap:10px;
      border:2px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      padding:12px;
      border-radius:18px;
      cursor:pointer;
      transition:.15s transform,.15s background,.15s outline;
      user-select:none;
      min-height:60px;
    }
    .emo-btn:hover{transform:translateY(-2px); background: rgba(255,255,255,.06);}
    .emo-btn.active{outline:3px solid rgba(90,120,255,.55);}
    .emo-color{
      width:42px;height:42px;border-radius:16px;border:2px solid rgba(0,0,0,.25);
      flex:0 0 auto;
    }
    .emo-text{
      display:flex;flex-direction:column;gap:2px;
      min-width:0;
    }
    .emo-name{
      font-weight:1000;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .emo-hint{font-size:12px;color:var(--muted);font-weight:700}

    /* Intensity: emoji scale */
    .intensity{
      display:flex;gap:10px;flex-wrap:wrap;
      margin-top:10px;
    }
    .star{
      flex:1 1 auto;
      min-width:110px;
      border:2px solid rgba(255,255,255,.14);
      border-radius:18px;
      background: rgba(0,0,0,.16);
      padding:12px;
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition:.15s transform,.15s background,.15s outline;
      font-weight:1000;
    }
    .star:hover{transform:translateY(-2px); background: rgba(255,255,255,.06);}
    .star.active{outline:3px solid rgba(90,120,255,.55);}

    /* Simple selects */
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px;font-weight:900}
    select, input{
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.22);
      color: var(--text);
      outline:none;
      font-size:14px;
    }
    select option{background:#000;color:var(--text)}
    .hint{
      background: rgba(255,255,255,.06);
      border:1px dashed rgba(255,255,255,.18);
      padding:10px 12px;border-radius:16px;
      font-size:12px;color:var(--muted);
      line-height:1.4;
    }

    .status{font-size:12px;color:var(--muted);font-weight:800}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Î§ÏÎ¿Î½Î¿Î£Ï…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± â€“ Î Î±Î¹Ï‡Î½Î¯Î´Î¹ 4 Î–Ï‰Î½ÏÎ½</h1>
          <div class="sub">Î”Î¹Î¬Î»ÎµÎ¾Îµ Î¶ÏÎ½Î· (Î ÏÏ‰Î¯/ÎœÎµÏƒÎ·Î¼Î­ÏÎ¹/Î‘Ï€ÏŒÎ³ÎµÏ…Î¼Î±/Î’ÏÎ¬Î´Ï…) â†’ Î´Î¹Î¬Î»ÎµÎ¾Îµ ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± Î±Ï€ÏŒ Ï„Î·Î½ â€œÏ€Î¯Ï„Î±â€ â†’ Î­Ï„Î¿Î¹Î¼Î¿!</div>
        </div>
      </div>
      <div class="btnbar">
        <button id="btnExportJSON" class="good">â¬‡ Î•Î¾Î±Î³Ï‰Î³Î® JSON</button>
        <button id="btnExportCSV" class="good">â¬‡ Î•Î¾Î±Î³Ï‰Î³Î® CSV</button>
        <button id="btnReset" class="bad">ğŸ§¹ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
      </div>
    </header>

    <section class="card">
      <div class="hd">
        <div>
          <div style="font-weight:1000">1) Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï„Î· Î¶ÏÎ½Î· Ï„Î·Ï‚ Î·Î¼Î­ÏÎ±Ï‚</div>
          <div class="small">Î Î¬Ï„Î± ÏƒÎµ Î¼Î¯Î± ÎºÎ¬ÏÏ„Î±. ÎœÎµÏ„Î¬ Î´Î¹Î¬Î»ÎµÎ¾Îµ ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± Î±Ï€ÏŒ Ï„Î·Î½ Ï€Î¯Ï„Î±.</div>
        </div>
        <div class="status" id="saveStatus">â— Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ</div>
      </div>
      <div class="bd">
        <div class="zones" id="zones"></div>
      </div>
    </section>

    <div style="height:12px"></div>

    <section class="card">
      <div class="hd">
        <div>
          <div style="font-weight:1000">2) Î Î±Î¹Ï‡Î½Î¯Î´Î¹ Î£Ï…Î½Î±Î¹ÏƒÎ¸Î®Î¼Î±Ï„Î¿Ï‚</div>
          <div class="small">Î Î¬Ï„Î± Î­Î½Î± Î¼ÎµÎ³Î¬Î»Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ ÏƒÏ…Î½Î±Î¹ÏƒÎ¸Î®Î¼Î±Ï„Î¿Ï‚ Î® Î³ÏÏÎ½Î± Ï„Î·Î½ Ï€Î¯Ï„Î± (Ï„Ï…Ï‡Î±Î¯Î± ÎµÏ€Î¹Î»Î¿Î³Î®).</div>
        </div>
        <div class="small">Î–ÏÎ½Î·: <b id="zoneLabel">Î ÏÏ‰Î¯</b></div>
      </div>

      <div class="bd game">
        <!-- LEFT: Wheel + emotion big list -->
        <div class="wheel-wrap">
          <div class="wheel-card">
            <div class="wheel-row">
              <div class="wheel" id="wheel" role="button" aria-label="Î Î¯Ï„Î± ÏƒÏ…Î½Î±Î¹ÏƒÎ¸Î®Î¼Î±Ï„Î¿Ï‚">
                <div class="pointer" aria-hidden="true"></div>
                <div class="wheel-center" id="wheelCenter">
                  <div class="center-label">Î”Î¹Î¬Î»ÎµÎ¾ÎµÏ‚:</div>
                  <div class="center-emotion" id="centerEmotion">â€”</div>
                  <div class="center-sub" id="centerSub">Î Î¬Ï„Î± Î­Î½Î± ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±</div>
                </div>
              </div>

              <div>
                <div class="hint">
                  ğŸ® <b>Î Î±Î¹Ï‡Î½Î¯Î´Î¹:</b> Î Î¬Ï„Î± Ï€Î¬Î½Ï‰ ÏƒÏ„Î·Î½ â€œÏ€Î¯Ï„Î±â€ Î³Î¹Î± <b>Ï„Ï…Ï‡Î±Î¯Î¿</b> ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±!<br/>
                  Î‰ Ï€Î¬Ï„Î± Î­Î½Î± Î±Ï€ÏŒ Ï„Î± Î¼ÎµÎ³Î¬Î»Î± ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ Î´ÎµÎ¾Î¹Î¬ Î³Î¹Î± Î½Î± Î´Î¹Î±Î»Î­Î¾ÎµÎ¹Ï‚ ÎµÏƒÏ.
                </div>

                <div class="intensity" id="intensity"></div>

                <div class="emo-list" id="emoList" style="margin-top:12px"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT: Simple context (kid-friendly) -->
        <div class="wheel-card">
          <div style="font-weight:1000;margin-bottom:6px">3) ÎœÏŒÎ½Î¿ 3 Î¼Î¹ÎºÏÎ­Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚</div>
          <div class="small">Î“Î¹Î± Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÎ¹ Ï€Î±Î¹Î´Î¯ Î¼ÏŒÎ½Î¿ Ï„Î¿Ï….</div>

          <label for="withWhom">ÎœÎµ Ï€Î¿Î¹Î¿Î½ ÎµÎ¯ÏƒÎ±Î¹;</label>
          <select id="withWhom"></select>

          <label for="where">Î Î¿Ï ÎµÎ¯ÏƒÎ±Î¹;</label>
          <select id="where"></select>

          <label for="what">Î¤Î¹ Î­Î³Î¹Î½Îµ;</label>
          <select id="what"></select>

          <div style="height:10px"></div>
          <button id="btnDone" class="primary" style="width:100%">âœ… Î¤Î•Î›ÎŸÎ£ Î³Î¹Î± Î±Ï…Ï„Î® Ï„Î· Î¶ÏÎ½Î·</button>
          <div id="doneMsg" class="small" style="margin-top:10px"></div>
        </div>
      </div>
    </section>
  </div>

<script>
  // ---------------- Data ----------------
  const STORAGE_KEY = "chronofeel_game_4zones_v1";

  const ZONES = [
    { key:"morning", label:"Î ÏÏ‰Î¯",     time:"06:00 â€“ 12:00", emoji:"ğŸŒ" },
    { key:"noon",    label:"ÎœÎµÏƒÎ·Î¼Î­ÏÎ¹", time:"12:00 â€“ 16:00", emoji:"ğŸ½ï¸" },
    { key:"aft",     label:"Î‘Ï€ÏŒÎ³ÎµÏ…Î¼Î±", time:"16:00 â€“ 20:00", emoji:"ğŸ®" },
    { key:"night",   label:"Î’ÏÎ¬Î´Ï…",    time:"20:00 â€“ 06:00", emoji:"ğŸŒ™" }
  ];

  // ÎœÎµÎ³Î¬Î»Î±, Î¾ÎµÎºÎ¬Î¸Î±ÏÎ± ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬ Î¿Î½ÏŒÎ¼Î±Ï„Î±
  const EMOTIONS = [
    {key:"yellow",  color:"#FFD400", name:"Î§Î±ÏÎ¬",        hint:"ÎÎ¹ÏÎ¸Ï‰ ÎºÎ±Î»Î¬ ğŸ˜Š"},
    {key:"orange",  color:"#FF8A00", name:"Î•Î½Î¸Î¿Ï…ÏƒÎ¹Î±ÏƒÎ¼ÏŒÏ‚",hint:"Î˜Î­Î»Ï‰ Î´ÏÎ¬ÏƒÎ·! ğŸ¤©"},
    {key:"pink",    color:"#FF4FD8", name:"Î‘Î³Î¬Ï€Î·",       hint:"Î¤ÏÏ…Ï†ÎµÏÏŒÏ„Î·Ï„Î± ğŸ’—"},
    {key:"green",   color:"#22C55E", name:"Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±",    hint:"Î‰ÏÎµÎ¼Î¿Ï‚/Î· ğŸ˜Œ"},
    {key:"lblue",   color:"#5AD7FF", name:"Î§Î±Î»Î¬ÏÏ‰ÏƒÎ·",    hint:"ÎÎµÎºÎ¿Ï…ÏÎ¬Î¶Î¿Î¼Î±Î¹ ğŸ§˜"},
    {key:"lpurple", color:"#A78BFA", name:"Î ÎµÏÎ¹Î­ÏÎ³ÎµÎ¹Î±",  hint:"Î˜Î­Î»Ï‰ Î½Î± Î¼Î¬Î¸Ï‰ ğŸ§"},
    {key:"lgray",   color:"#D1D5DB", name:"Î Î»Î®Î¾Î·",       hint:"Î”ÎµÎ½ Î­Ï‡Ï‰ Ï„Î¹ Î½Î± ÎºÎ¬Î½Ï‰ ğŸ˜‘"},
    {key:"dgray",   color:"#6B7280", name:"Î£Ï„ÎµÎ½Î±Ï‡ÏÏÎ¹Î±",  hint:"ÎšÎ¬Ï„Î¹ Î¼Îµ Î²Î±ÏÎ±Î¯Î½ÎµÎ¹ ğŸ˜”"},
    {key:"dblue",   color:"#1F3B88", name:"ÎœÎ¿Î½Î±Î¾Î¹Î¬",     hint:"ÎÎ¹ÏÎ¸Ï‰ Î¼ÏŒÎ½Î¿Ï‚/Î· ğŸ¥º"},
    {key:"brown",   color:"#A16207", name:"Î£ÏÎ³Ï‡Ï…ÏƒÎ·",     hint:"Î”ÎµÎ½ ÎºÎ±Ï„Î±Î»Î±Î²Î±Î¯Î½Ï‰ ğŸ˜µ"},
    {key:"red",     color:"#EF4444", name:"Î˜Ï…Î¼ÏŒÏ‚",       hint:"Î•ÎºÎ½ÎµÏ…ÏÎ¯ÏƒÏ„Î·ÎºÎ± ğŸ˜¡"},
    {key:"black",   color:"#111827", name:"Î¦ÏŒÎ²Î¿Ï‚",       hint:"Î¦Î¿Î²Î¬Î¼Î±Î¹ ğŸ˜¨"},
    {key:"dpurple", color:"#7C3AED", name:"ÎÏ„ÏÎ¿Ï€Î®/Î•Î½Î¿Ï‡Î®",hint:"ÎÏ„ÏÎ­Ï€Î¿Î¼Î±Î¹ ğŸ˜³"},
    {key:"white",   color:"#FFFFFF", name:"Î¤Î¯Ï€Î¿Ï„Î±",      hint:"Î”ÎµÎ½ Î½Î¹ÏÎ¸Ï‰ ÎºÎ¬Ï„Î¹ ğŸ˜"},
  ];

  const INTENSITY = [
    { key:"Î»Î¯Î³Î¿", label:"ğŸ™‚ Î›Î¯Î³Î¿" },
    { key:"Î¼Î­Ï„ÏÎ¹Î±", label:"ğŸ˜€ ÎœÎ­Ï„ÏÎ¹Î±" },
    { key:"Ï€Î¿Î»Ï", label:"ğŸ˜ƒ Î Î¿Î»Ï" },
    { key:"Ï€Î¬ÏÎ± Ï€Î¿Î»Ï", label:"ğŸ¤¯ Î Î¬ÏÎ± Ï€Î¿Î»Ï" },
  ];

  const WITH_WHOM = ["ÎœÏŒÎ½Î¿Ï‚/Î·","ÎœÎ±Î¼Î¬","ÎœÏ€Î±Î¼Ï€Î¬Ï‚","Î‘Î´ÎµÏÏ†ÏŒÏ‚/Î‘Î´ÎµÏÏ†Î®","Î Î±Ï€Ï€Î¿ÏÏ‚/Î“Î¹Î±Î³Î¹Î¬","Î¦Î¯Î»Î¿Ï‚/Î¦Î¯Î»Î·","Î”Î¬ÏƒÎºÎ±Î»Î¿Ï‚/Î”Î±ÏƒÎºÎ¬Î»Î±"];
  const WHERE = ["Î£Ï€Î¯Ï„Î¹","Î£Ï‡Î¿Î»ÎµÎ¯Î¿","Î”Ï‰Î¼Î¬Ï„Î¹ÏŒ Î¼Î¿Ï…","Î‘Ï…Î»Î®/Î Î¬ÏÎºÎ¿","Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±/Î£Ï€Î¿Ï","Î‘Ï…Ï„Î¿ÎºÎ¯Î½Î·Ï„Î¿"];
  const WHAT = ["Î Î±Î¹Ï‡Î½Î¯Î´Î¹","ÎœÎ¬Î¸Î·Î¼Î±/Î”Î¹Î¬Î²Î±ÏƒÎ¼Î±","Î¦Î±Î³Î·Ï„ÏŒ","ÎšÎ±Ï…Î³Î¬Ï‚/Î¦Ï‰Î½Î­Ï‚","ÎœÎ¿Ï…ÏƒÎ¹ÎºÎ®/Î§Î¿ÏÏŒÏ‚","ÎÏ€Î½Î¿Ï‚/ÎÎµÎºÎ¿ÏÏÎ±ÏƒÎ·","ÎšÎ¬Ï„Î¹ Î¬Î»Î»Î¿"];

  const DEFAULT_ZONE = () => ({
    emotionKey:null,
    intensityKey:null,
    withWhom:"",
    where:"",
    what:"",
  });

  let state = {
    selectedZoneKey: "morning",
    zones: Object.fromEntries(ZONES.map(z => [z.key, DEFAULT_ZONE()])),
  };

  // ---------------- Helpers ----------------
  const $ = (id) => document.getElementById(id);

  function setSaved(flag){
    const el = $("saveStatus");
    el.textContent = flag ? "â— Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ" : "â— Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·â€¦";
    el.style.color = flag ? "var(--muted)" : "var(--warn)";
  }
  function autosave(){
    setSaved(false);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    setTimeout(()=>setSaved(true), 120);
  }
  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const s = JSON.parse(raw);
      if(s && s.zones) state = s;
    }catch(e){}
  }
  function zoneEntry(){
    return state.zones[state.selectedZoneKey];
  }
  function emoByKey(k){ return EMOTIONS.find(e=>e.key===k) || null; }
  function zoneByKey(k){ return ZONES.find(z=>z.key===k) || ZONES[0]; }

  // ---------------- UI build ----------------
  function buildZones(){
    const wrap = $("zones");
    wrap.innerHTML = "";
    ZONES.forEach(z=>{
      const d = document.createElement("div");
      d.className = "zone";
      d.dataset.key = z.key;

      const entry = state.zones[z.key];
      const emo = emoByKey(entry.emotionKey);

      d.innerHTML = `
        <div class="zone-title">${z.emoji} ${z.label}</div>
        <div class="zone-time">${z.time}</div>
        <div class="zone-mini">
          ${emo ? `<span class="chip"><span class="dot" style="background:${emo.color}"></span>${emo.name}</span>` : `<span class="small">Î”Î¹Î¬Î»ÎµÎ¾Îµ ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±â€¦</span>`}
        </div>
      `;

      d.addEventListener("click", ()=>{
        state.selectedZoneKey = z.key;
        render();
        autosave();
      });

      wrap.appendChild(d);
    });
  }

  function buildIntensity(){
    const wrap = $("intensity");
    wrap.innerHTML = "";
    INTENSITY.forEach(it=>{
      const b = document.createElement("div");
      b.className = "star";
      b.textContent = it.label;
      b.dataset.key = it.key;
      b.addEventListener("click", ()=>{
        if(!zoneEntry().emotionKey) return;
        zoneEntry().intensityKey = it.key;
        autosave();
        render();
      });
      wrap.appendChild(b);
    });
  }

  function buildEmoList(){
    const wrap = $("emoList");
    wrap.innerHTML = "";
    EMOTIONS.forEach(e=>{
      const b = document.createElement("div");
      b.className = "emo-btn";
      b.dataset.key = e.key;
      b.innerHTML = `
        <div class="emo-color" style="background:${e.color}"></div>
        <div class="emo-text">
          <div class="emo-name">${e.name}</div>
          <div class="emo-hint">${e.hint}</div>
        </div>
      `;
      b.addEventListener("click", ()=>{
        zoneEntry().emotionKey = e.key;
        // Î±Î½ Î±Î»Î»Î¬Î¾ÎµÎ¹ ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±, ÎºÎ±Î¸Î¬ÏÎ¹ÏƒÎµ Î­Î½Ï„Î±ÏƒÎ·
        zoneEntry().intensityKey = null;
        autosave();
        render();
      });
      wrap.appendChild(b);
    });
  }

  function fillSelect(id, options, placeholder){
    const sel = $(id);
    sel.innerHTML = "";
    const o = document.createElement("option");
    o.value = "";
    o.textContent = placeholder;
    sel.appendChild(o);
    options.forEach(v=>{
      const opt = document.createElement("option");
      opt.value = v;
      opt.textContent = v;
      sel.appendChild(opt);
    });
  }

  // ---------------- Wheel "game" ----------------
  function pickRandomEmotion(){
    const idx = Math.floor(Math.random() * EMOTIONS.length);
    const e = EMOTIONS[idx];
    zoneEntry().emotionKey = e.key;
    zoneEntry().intensityKey = null;
    autosave();
    render();
  }

  // ---------------- Render ----------------
  function render(){
    buildZones();

    // active zone styling
    document.querySelectorAll(".zone").forEach(z=>{
      z.classList.toggle("active", z.dataset.key === state.selectedZoneKey);
    });

    const z = zoneByKey(state.selectedZoneKey);
    $("zoneLabel").textContent = z.label;

    // center emotion
    const entry = zoneEntry();
    const emo = emoByKey(entry.emotionKey);
    $("centerEmotion").textContent = emo ? emo.name : "â€”";
    $("centerSub").textContent = emo
      ? (entry.intensityKey ? `ÎˆÎ½Ï„Î±ÏƒÎ·: ${entry.intensityKey.toUpperCase()}` : "Î”Î¹Î¬Î»ÎµÎ¾Îµ Î­Î½Ï„Î±ÏƒÎ· â†“")
      : "Î Î¬Ï„Î± Î­Î½Î± ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±";

    // highlight emo buttons
    document.querySelectorAll(".emo-btn").forEach(b=>{
      b.classList.toggle("active", b.dataset.key === entry.emotionKey);
    });

    // intensity enable + active
    document.querySelectorAll(".star").forEach(s=>{
      const k = s.dataset.key;
      const enabled = !!entry.emotionKey;
      s.style.opacity = enabled ? "1" : "0.45";
      s.style.pointerEvents = enabled ? "auto" : "none";
      s.classList.toggle("active", k === entry.intensityKey);
    });

    // selects
    $("withWhom").value = entry.withWhom || "";
    $("where").value = entry.where || "";
    $("what").value = entry.what || "";
  }

  // ---------------- Export ----------------
  function buildExport(){
    return {
      ÎµÏÎ³Î±Î»ÎµÎ¯Î¿: "Î§ÏÎ¿Î½Î¿Î£Ï…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± â€“ 4 Î–ÏÎ½ÎµÏ‚",
      Î­ÎºÎ´Î¿ÏƒÎ·: "1.0",
      Î¶ÏÎ½ÎµÏ‚: ZONES.map(z=>{
        const e = state.zones[z.key];
        const emo = emoByKey(e.emotionKey);
        return {
          Î¶ÏÎ½Î·: z.label,
          Î´Î¹Î¬ÏƒÏ„Î·Î¼Î±: z.time,
          ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±: emo ? emo.name : "",
          Ï‡ÏÏÎ¼Î±: emo ? emo.color : "",
          Î­Î½Ï„Î±ÏƒÎ·: e.intensityKey || "",
          Î¼Îµ_Ï€Î¿Î¹Î¿Î½: e.withWhom || "",
          Ï€Î¿Ï: e.where || "",
          Ï„Î¹_Î­Î³Î¹Î½Îµ: e.what || ""
        };
      })
    };
  }

  function csvEscape(v){
    const s = (v ?? "").toString();
    if(/[",\n]/.test(s)) return `"${s.replaceAll('"','""')}"`;
    return s;
  }

  function buildCSV(){
    const header = ["Î¶ÏÎ½Î·","Î´Î¹Î¬ÏƒÏ„Î·Î¼Î±","ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±","Ï‡ÏÏÎ¼Î±","Î­Î½Ï„Î±ÏƒÎ·","Î¼Îµ_Ï€Î¿Î¹Î¿Î½","Ï€Î¿Ï","Ï„Î¹_Î­Î³Î¹Î½Îµ"].join(",");
    const rows = ZONES.map(z=>{
      const e = state.zones[z.key];
      const emo = emoByKey(e.emotionKey);
      return [
        z.label,
        z.time,
        emo?.name || "",
        emo?.color || "",
        e.intensityKey || "",
        e.withWhom || "",
        e.where || "",
        e.what || ""
      ].map(csvEscape).join(",");
    });
    return [header, ...rows].join("\n");
  }

  function downloadFile(filename, content, mime){
    const blob = new Blob([content], {type:mime});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href), 800);
  }

  // ---------------- Init ----------------
  function init(){
    load();

    buildIntensity();
    buildEmoList();
    fillSelect("withWhom", WITH_WHOM, "Î”Î¹Î¬Î»ÎµÎ¾Îµâ€¦");
    fillSelect("where", WHERE, "Î”Î¹Î¬Î»ÎµÎ¾Îµâ€¦");
    fillSelect("what", WHAT, "Î”Î¹Î¬Î»ÎµÎ¾Îµâ€¦");

    // hook selects
    $("withWhom").addEventListener("change", e=>{ zoneEntry().withWhom = e.target.value; autosave(); });
    $("where").addEventListener("change", e=>{ zoneEntry().where = e.target.value; autosave(); });
    $("what").addEventListener("change", e=>{ zoneEntry().what = e.target.value; autosave(); });

    // wheel click = random game
    $("wheel").addEventListener("click", pickRandomEmotion);

    // done message
    $("btnDone").addEventListener("click", ()=>{
      const entry = zoneEntry();
      const ok = !!entry.emotionKey && !!entry.intensityKey;
      const msg = ok
        ? "âœ… Î¤Î­Î»ÎµÎ¹Î±! Î Î®Î³Î±Î¹Î½Îµ ÏƒÎµ Î¬Î»Î»Î· Î¶ÏÎ½Î· Î® ÎºÎ¬Î½Îµ ÎµÎ¾Î±Î³Ï‰Î³Î®."
        : "âš  Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï€ÏÏÏ„Î± ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± ÎšÎ‘Î™ Î­Î½Ï„Î±ÏƒÎ·.";
      $("doneMsg").textContent = msg;
      $("doneMsg").style.color = ok ? "var(--good)" : "var(--warn)";
    });

    // export
    $("btnExportJSON").addEventListener("click", ()=>{
      downloadFile("chronosynaisthima_4zones.json", JSON.stringify(buildExport(), null, 2), "application/json");
    });
    $("btnExportCSV").addEventListener("click", ()=>{
      downloadFile("chronosynaisthima_4zones.csv", buildCSV(), "text/csv;charset=utf-8");
    });

    // reset
    $("btnReset").addEventListener("click", ()=>{
      if(!confirm("Î£Î¯Î³Î¿Ï…ÏÎ±; Î˜Î± Ï‡Î±Î¸Î¿ÏÎ½ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±.")) return;
      localStorage.removeItem("chronofeel_game_4zones_v1");
      state = { selectedZoneKey:"morning", zones: Object.fromEntries(ZONES.map(z => [z.key, DEFAULT_ZONE()])) };
      autosave();
      render();
      $("doneMsg").textContent = "";
    });

    render();
    setSaved(true);
  }

  init();
</script>
</body>
</html>