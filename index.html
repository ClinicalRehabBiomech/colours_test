<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Î§ÏÎ¿Î½Î¿Î£Ï…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± 24 â€“ Î–ÏÎ½ÎµÏ‚ (Î Î±Î¹Ï‡Î½Î¯Î´Î¹)</title>

  <style>
    :root{
      --text:#10243a;
      --muted:#3b556f;
      --border: rgba(16,36,58,.18);
      --shadow: 0 18px 46px rgba(2,6,23,.18);
      --radius:26px;

      --base: clamp(16px, 1.2vw, 20px);
      --h1: clamp(18px, 2vw, 28px);
      --pie: clamp(280px, 48vw, 520px);
      --center: clamp(160px, 26vw, 240px);

      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;

      /* âœ… Pie colors (MUST exist) */
      --c-red:#EF4444;
      --c-blue:#1F3B88;
      --c-yellow:#FFD400;
      --c-green:#22C55E;
      --c-black:#111827;
      --c-white:#FFFFFF;
      --c-purple:#7C3AED;
      --c-brown:#A16207;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      font-size: var(--base);
      min-height:100vh;
      overflow-x:hidden;
      transition: background .25s ease, color .25s ease;
      color: var(--text);
    }

    /* zone themes */
    body.zone-morning{
      background:
        radial-gradient(180px 180px at 80% 18%, rgba(255,214,102,.95), transparent 62%),
        radial-gradient(900px 520px at 20% 15%, rgba(255,255,255,.85), transparent 60%),
        linear-gradient(160deg, #a9ddff, #fff6cc 55%, #ffffff);
    }
    body.zone-noon{
      background:
        radial-gradient(220px 220px at 78% 18%, rgba(255,200,60,.95), transparent 62%),
        radial-gradient(900px 520px at 25% 15%, rgba(255,255,255,.80), transparent 62%),
        linear-gradient(160deg, #7fd3ff, #bff0ff 45%, #fff2c9);
    }
    body.zone-afternoon{
      background:
        radial-gradient(240px 200px at 80% 20%, rgba(255,140,80,.85), transparent 65%),
        radial-gradient(900px 520px at 25% 15%, rgba(255,255,255,.75), transparent 62%),
        linear-gradient(160deg, #ffd1a1, #ffb3d6 55%, #fff7d6);
    }
    body.zone-night{
      background:
        radial-gradient(160px 160px at 82% 18%, rgba(230,230,255,.90), transparent 62%),
        radial-gradient(720px 520px at 20% 10%, rgba(255,255,255,.12), transparent 62%),
        radial-gradient(900px 700px at 60% 90%, rgba(90,120,255,.10), transparent 62%),
        linear-gradient(160deg, #06132b, #0b2a5e 55%, #1b3b6f);
      color:#eef6ff;
    }
    body.zone-night .card{background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18);}
    body.zone-night .small{color: rgba(238,246,255,.80)}
    body.zone-night .muted{color: rgba(238,246,255,.75)}
    body.zone-night .choice{background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.20);}
    body.zone-night .choice:hover{background: rgba(255,255,255,.16);}
    body.zone-night .btn{background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.22); color:#eef6ff;}
    body.zone-night .btn.primary{background: rgba(90,120,255,.28);}

    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-bottom:12px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:56px;height:56px;border-radius:18px;
      background: conic-gradient(from 180deg,
        var(--c-red,#EF4444), var(--c-blue,#1F3B88), var(--c-yellow,#FFD400), var(--c-green,#22C55E),
        var(--c-black,#111827), var(--c-white,#FFFFFF), var(--c-purple,#7C3AED), var(--c-brown,#A16207)
      );
      border:2px solid rgba(255,255,255,.8);
      box-shadow: var(--shadow);
    }
    h1{font-size:var(--h1); margin:0; font-weight:1100}
    .small{font-size:14px; line-height:1.35}
    .muted{color: var(--muted); font-weight:900}

    details.menu{
      border:1px solid var(--border);
      background: rgba(255,255,255,.70);
      border-radius:18px;
      padding:10px 12px;
      box-shadow: 0 10px 22px rgba(2,6,23,.10);
      user-select:none;
    }
    details.menu > summary{
      cursor:pointer; font-weight:1100; list-style:none;
      display:flex; gap:8px; align-items:center;
    }
    details.menu > summary::-webkit-details-marker{display:none}

    .card{
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(255,255,255,.72);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      background: rgba(255,255,255,.55);
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    .bd{padding:16px}

    .topline{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .pill{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.75);
      font-weight:1100;
      font-size:14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
    }

    /* Pie */
    .pieWrap{display:flex;flex-direction:column;gap:12px;align-items:center}
    .pie{
      width: var(--pie);
      height: var(--pie);
      max-width: 100%;
      border-radius:50%;
      position:relative;
      overflow:hidden;
      border:3px solid rgba(255,255,255,.85);
      box-shadow: var(--shadow);

      /* âœ… FIX: fallback colors so gradient is NEVER invalid */
      background:
        conic-gradient(
          var(--c-red,   #EF4444) 0 45deg,
          var(--c-blue,  #1F3B88) 45 90deg,
          var(--c-yellow,#FFD400) 90 135deg,
          var(--c-green, #22C55E) 135 180deg,
          var(--c-black, #111827) 180 225deg,
          var(--c-white, #FFFFFF) 225 270deg,
          var(--c-purple,#7C3AED) 270 315deg,
          var(--c-brown, #A16207) 315 360deg
        );
    }
    .pointer{
      position:absolute; top:-12px; left:50%;
      transform:translateX(-50%);
      width:0;height:0;
      border-left:16px solid transparent;
      border-right:16px solid transparent;
      border-bottom:26px solid rgba(255,255,255,.95);
      filter: drop-shadow(0 8px 14px rgba(2,6,23,.20));
      z-index:6;
    }

    /* Inner ring shows 3 questions progress */
    .innerRing{
      position:absolute;
      inset: clamp(54px, 8vw, 86px);
      border-radius:50%;
      border:2px solid rgba(255,255,255,.55);
      background:
        conic-gradient(
          var(--q1, rgba(255,255,255,.22)) 0 120deg,
          var(--q2, rgba(255,255,255,.22)) 120 240deg,
          var(--q3, rgba(255,255,255,.22)) 240 360deg
        );
      z-index:2;
      box-shadow: inset 0 0 0 6px rgba(255,255,255,.28);
    }
    .innerRing::after{
      content:"";
      position:absolute; inset: 14px;
      border-radius:50%;
      /* âœ… slightly less white overlay so pie colors stay visible */
      background: rgba(255,255,255,.18);
      border:1px solid rgba(16,36,58,.10);
    }

    /* Intensity ring */
    .intensityRing{
      position:absolute;
      inset: clamp(26px, 4vw, 42px);
      border-radius:50%;
      border:3px solid rgba(255,255,255,.65);
      z-index:1;
      pointer-events:none;
      opacity:.95;
      background: conic-gradient(rgba(255,255,255,.00) 0 360deg);
    }

    .center{
      position:absolute; left:50%; top:50%;
      transform:translate(-50%,-50%);
      width: var(--center);
      height: var(--center);
      border-radius:50%;
      background: rgba(255,255,255,.90);
      border:2px solid rgba(16,36,58,.12);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:14px;
      z-index:5;
    }
    .centerTitle{
      font-size:14px;
      font-weight:1100;
      color: var(--muted);
      margin-bottom:6px;
    }
    .centerMain{
      font-size:20px;
      font-weight:1200;
      line-height:1.1;
    }
    .centerSub{
      margin-top:8px;
      font-size:14px;
      font-weight:1000;
      color: var(--muted);
      line-height:1.25;
      white-space:pre-line;
      display:-webkit-box;
      -webkit-line-clamp:4;
      -webkit-box-orient:vertical;
      overflow:hidden;
      max-width:100%;
    }

    /* Right: Kid-friendly big choices */
    .stepTitle{
      font-weight:1200;
      font-size:18px;
      margin:6px 0 6px;
    }
    .helper{
      font-size:14px;
      color: var(--muted);
      font-weight:900;
      line-height:1.35;
      margin-bottom:10px;
    }

    .choices{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width: 520px){
      .choices{grid-template-columns:1fr;}
    }
    .choice{
      border:2px solid rgba(16,36,58,.14);
      border-radius:20px;
      background: rgba(255,255,255,.70);
      padding:12px;
      cursor:pointer;
      transition:.15s transform,.15s background,.15s outline;
      user-select:none;
      display:flex;
      gap:12px;
      align-items:center;
      min-height:76px;
      overflow:hidden;
    }
    .choice:hover{transform:translateY(-2px); background: rgba(255,255,255,.92);}
    .choice.active{outline:3px solid rgba(90,120,255,.40);}
    .swatch{
      width:54px;height:54px;border-radius:18px;border:2px solid rgba(0,0,0,.10);
      flex:0 0 auto;
    }
    .choiceBig{
      font-size:18px;
      font-weight:1200;
      line-height:1.05;
    }
    .choiceSmall{
      font-size:14px;
      font-weight:1000;
      color: var(--muted);
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    .row1{display:grid;grid-template-columns:repeat(4, minmax(0,1fr));gap:10px}
    @media (max-width: 520px){ .row1{grid-template-columns:repeat(2,1fr)} }
    .emojiBtn{
      border:2px solid rgba(16,36,58,.14);
      background: rgba(255,255,255,.70);
      border-radius:20px;
      padding:14px 10px;
      cursor:pointer;
      text-align:center;
      font-weight:1200;
      transition:.15s transform,.15s background,.15s outline;
      user-select:none;
      min-height:72px;
    }
    .emojiBtn:hover{transform:translateY(-2px); background: rgba(255,255,255,.92);}
    .emojiBtn.active{outline:3px solid rgba(90,120,255,.40);}
    .emojiBig{font-size:28px;display:block;margin-bottom:6px}
    .emojiText{font-size:14px}

    .btnRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.78);
      color: inherit;
      padding:12px 14px;
      border-radius:18px;
      cursor:pointer;
      font-weight:1200;
      font-size:16px;
      box-shadow: 0 10px 22px rgba(2,6,23,.10);
      transition:.15s transform,.15s background;
    }
    .btn:hover{transform:translateY(-1px); background: rgba(255,255,255,.95);}
    .btn.primary{background: rgba(90,120,255,.20); border-color: rgba(90,120,255,.30);}
    .btn:disabled{opacity:.55; cursor:not-allowed; transform:none;}

    .progress{
      margin-top:10px;
      font-size:14px;
      font-weight:1100;
      color: var(--muted);
    }
    .okline{
      margin-top:10px;
      font-size:14px;
      font-weight:1200;
      color: var(--good);
    }
    .warnline{
      margin-top:10px;
      font-size:14px;
      font-weight:1200;
      color: var(--warn);
    }
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1 id="zoneTitle">Î–ÏÎ½Î·: Î ÏÏ‰Î¯ â˜€ï¸</h1>
        <div class="small muted" id="zoneSubtitle">Î’Î®Î¼Î± 1/4 â€” Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï‡ÏÏÎ¼Î±, Ï€ÏŒÏƒÎ¿ ÎºÎ±Î¹ Î±Ï€Î¬Î½Ï„Î·ÏƒÎµ 3 ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚.</div>
      </div>
    </div>

    <details class="menu">
      <summary>âš™ï¸ ÎœÎµÎ½Î¿Ï (Î³Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯Î±)</summary>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="btn" id="btnExportJSON">â¬‡ JSON</button>
        <button class="btn" id="btnExportCSV">â¬‡ CSV</button>
        <button class="btn" id="btnReset">ğŸ§¹ Reset</button>
      </div>
      <div class="small muted" style="margin-top:10px">
        Î¤Î¿ Ï€Î±Î¹Î´Î¯ Î´ÎµÎ½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î±Ï…Ï„ÏŒ Ï„Î¿ Î¼ÎµÎ½Î¿Ï.
      </div>
    </details>
  </header>

  <section class="card">
    <div class="hd">
      <div class="topline">
        <span class="pill" id="pillZone">â˜€ï¸ Î ÏÏ‰Î¯</span>
        <span class="pill" id="pillStep">1/4</span>
      </div>
      <div class="small muted" id="saveStatus">â— Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ</div>
    </div>

    <div class="bd grid">
      <!-- LEFT: PIE -->
      <div class="pieWrap">
        <div class="pie" id="pie" role="button" aria-label="Î Î¯Ï„Î± Ï‡ÏÏ‰Î¼Î¬Ï„Ï‰Î½">
          <div class="pointer" aria-hidden="true"></div>
          <div class="intensityRing" id="intensityRing" aria-hidden="true"></div>
          <div class="innerRing" id="innerRing" aria-hidden="true"></div>

          <div class="center" id="center">
            <div class="centerTitle">Î”Î¹Î¬Î»ÎµÎ¾ÎµÏ‚:</div>
            <div class="centerMain" id="centerMain">â€”</div>
            <div class="centerSub" id="centerSub">Î Î¬Ï„Î± Î­Î½Î± Ï‡ÏÏÎ¼Î± ÏƒÏ„Î·Î½ Ï€Î¯Ï„Î±</div>
          </div>
        </div>

        <div class="progress" id="progressText">Î§ÏÏÎ¼Î±: â—‹  â€¢  Î ÏŒÏƒÎ¿: â—‹  â€¢  Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚: â—‹â—‹â—‹</div>
        <div id="statusLine" class="warnline">Î ÏÏÏ„Î± Î´Î¹Î¬Î»ÎµÎ¾Îµ Ï‡ÏÏÎ¼Î± ğŸ™‚</div>
      </div>

      <!-- RIGHT: CONTROLS -->
      <div>
        <div class="stepTitle">1) Î§ÏÏÎ¼Î±</div>
        <div class="helper">Î Î¬Ï„Î± Ï€Î¬Î½Ï‰ ÏƒÏ„Î·Î½ Ï€Î¯Ï„Î± (Î±ÏÎ¹ÏƒÏ„ÎµÏÎ¬) Î³Î¹Î± Î½Î± Î´Î¹Î±Î»Î­Î¾ÎµÎ¹Ï‚ Ï‡ÏÏÎ¼Î±.</div>

        <div class="stepTitle">2) Î ÏŒÏƒÎ¿ Ï„Î¿ Î½Î¹ÏÎ¸ÎµÎ¹Ï‚;</div>
        <div class="helper">Î”Î¹Î¬Î»ÎµÎ¾Îµ Î­Î½Î± Î±Ï€ÏŒ Ï„Î± 4 ÎºÎ¿Ï…Î¼Ï€Î¹Î¬.</div>
        <div class="row1" id="intensityRow"></div>

        <div class="stepTitle">3) ÎŸÎ¹ 3 ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚</div>
        <div class="helper">Î Î¬Ï„Î± Î¼Î¹Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÏƒÎµ ÎºÎ¬Î¸Îµ ÎµÏÏÏ„Î·ÏƒÎ·.</div>

        <div class="stepTitle" style="font-size:16px;margin-top:10px">3Î±) Î ÏŒÏƒÎ¿ ÏƒÏ…Ï‡Î½Î¬ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹;</div>
        <div class="choices" id="qFreq"></div>

        <div class="stepTitle" style="font-size:16px;margin-top:10px">3Î²) Î ÏŒÏ„Îµ Î¾ÎµÎºÎ¯Î½Î·ÏƒÎµ;</div>
        <div class="choices" id="qStart"></div>

        <div class="stepTitle" style="font-size:16px;margin-top:10px">3Î³) Î¤Î¹ Ï„Î¿ Ï€ÏÎ¿ÎºÎ¬Î»ÎµÏƒÎµ;</div>
        <div class="choices" id="qTrig"></div>

        <div class="btnRow">
          <button class="btn" id="btnPrev">â¬…ï¸ Î Î¯ÏƒÏ‰</button>
          <button class="btn primary" id="btnNext">â¡ï¸ Î•Ï€ÏŒÎ¼ÎµÎ½Î¿</button>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  // ---------- DATA ----------
  const STORAGE_KEY = "chronosynaisthima24_zonewizard_v1";

  const ZONES = [
    {key:"morning",   icon:"â˜€ï¸", title:"Î ÏÏ‰Î¯",     bodyClass:"zone-morning"},
    {key:"noon",      icon:"ğŸŒ¤ï¸", title:"ÎœÎµÏƒÎ·Î¼Î­ÏÎ¹", bodyClass:"zone-noon"},
    {key:"afternoon", icon:"ğŸŒ‡", title:"Î‘Ï€ÏŒÎ³ÎµÏ…Î¼Î±", bodyClass:"zone-afternoon"},
    {key:"night",     icon:"ğŸŒ™", title:"Î’ÏÎ¬Î´Ï…",    bodyClass:"zone-night"},
  ];

  // 8 slices, clickable by angle
  const COLORS = [
    {key:"red",    color:"#EF4444", name:"ÎšÏŒÎºÎºÎ¹Î½Î¿", emotions:"Î˜Ï…Î¼ÏŒÏ‚ / ÎˆÎ½Ï„Î±ÏƒÎ·"},
    {key:"blue",   color:"#1F3B88", name:"ÎœÏ€Î»Îµ",    emotions:"Î›ÏÏ€Î· / ÎœÎ¿Î½Î±Î¾Î¹Î¬"},
    {key:"yellow", color:"#FFD400", name:"ÎšÎ¯Ï„ÏÎ¹Î½Î¿", emotions:"Î§Î±ÏÎ¬ / Î•Î»Ï€Î¯Î´Î±"},
    {key:"green",  color:"#22C55E", name:"Î ÏÎ¬ÏƒÎ¹Î½Î¿", emotions:"Î—ÏÎµÎ¼Î¯Î± / Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±"},
    {key:"black",  color:"#111827", name:"ÎœÎ±ÏÏÎ¿",   emotions:"Î¦ÏŒÎ²Î¿Ï‚"},
    {key:"white",  color:"#FFFFFF", name:"Î†ÏƒÏ€ÏÎ¿",   emotions:"ÎšÎµÎ½ÏŒ / ÎœÎ¿ÏÎ´Î¹Î±ÏƒÎ¼Î±"},
    {key:"purple", color:"#7C3AED", name:"ÎœÏ‰Î²",     emotions:"Î£ÏÎ³Ï‡Ï…ÏƒÎ·"},
    {key:"brown",  color:"#A16207", name:"ÎšÎ±Ï†Î­",    emotions:"Î‘Î½Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±"},
  ];

  // intensity affects ring fill amount (25/50/75/100)
  const INTENSITIES = [
    {key:"Î»Î¯Î³Î¿",      emoji:"ğŸ™‚", label:"Î›Î¯Î³Î¿",      fill: 90},
    {key:"Î±ÏÎºÎµÏ„Î¬",    emoji:"ğŸ˜€", label:"Î‘ÏÎºÎµÏ„Î¬",    fill: 180},
    {key:"Ï€Î¿Î»Ï",      emoji:"ğŸ˜Ÿ", label:"Î Î¿Î»Ï",      fill: 270},
    {key:"Ï€Î¬ÏÎ± Ï€Î¿Î»Ï", emoji:"ğŸ˜±", label:"Î Î¬ÏÎ± Ï€Î¿Î»Ï", fill: 360},
  ];

  const FREQ = [
    {k:"ÎºÎ¬Î¸Îµ Î¼Î­ÏÎ±", e:"ğŸ“…", t:"ÎšÎ¬Î¸Îµ Î¼Î­ÏÎ±"},
    {k:"ÏƒÏ…Ï‡Î½Î¬",     e:"ğŸ”", t:"Î£Ï…Ï‡Î½Î¬"},
    {k:"Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚", e:"ğŸ™‚", t:"ÎœÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚"},
    {k:"ÏƒÏ€Î¬Î½Î¹Î±",    e:"ğŸ«§", t:"Î£Ï€Î¬Î½Î¹Î±"},
  ];

  const START = [
    {k:"Ï€ÏÎ¹Î½ Î»Î¯Î³ÎµÏ‚ Î¼Î­ÏÎµÏ‚", e:"ğŸ•’", t:"Î ÏÎ¹Î½ Î»Î¯Î³ÎµÏ‚ Î¼Î­ÏÎµÏ‚"},
    {k:"Ï€ÏÎ¹Î½ 1 Î¼Î®Î½Î±",      e:"ğŸ—“ï¸", t:"Î ÏÎ¹Î½ 1 Î¼Î®Î½Î±"},
    {k:"Ï€ÏÎ¹Î½ Î¼Î®Î½ÎµÏ‚",       e:"ğŸ“†", t:"Î ÏÎ¹Î½ Î¼Î®Î½ÎµÏ‚"},
    {k:"Ï€ÏÎ¹Î½ 1 Ï‡ÏÏŒÎ½Î¿+",    e:"â³", t:"Î ÏÎ¹Î½ 1 Ï‡ÏÏŒÎ½Î¿+"},
  ];

  // short kid-friendly triggers (replace with your exact docx list if needed)
  const TRIG = [
    {k:"Ï†Ï‰Î½Î­Ï‚",     e:"ğŸ“¢", t:"Î¦Ï‰Î½Î­Ï‚"},
    {k:"Ï„ÏƒÎ±ÎºÏ‰Î¼ÏŒÏ‚",   e:"ğŸ’¥", t:"Î¤ÏƒÎ±ÎºÏ‰Î¼ÏŒÏ‚"},
    {k:"Î¼ÏŒÎ½Î¿Ï‚/Î·",   e:"ğŸ™", t:"ÎœÏŒÎ½Î¿Ï‚/Î·"},
    {k:"Î¼Î±Î¶Î¯/Î±Î³ÎºÎ±Î»Î¹Î¬", e:"ğŸ¤—", t:"ÎœÎ±Î¶Î¯ / Î‘Î³ÎºÎ±Î»Î¹Î¬"},
  ];

  const DEFAULT_ZONE_ENTRY = () => ({
    colorKey: null,
    intensityKey: null,
    freqKey: null,
    startKey: null,
    trigKey: null
  });

  let state = {
    idx: 0,
    zones: Object.fromEntries(ZONES.map(z => [z.key, DEFAULT_ZONE_ENTRY()])),
  };

  // ---------- Helpers ----------
  const $ = (id) => document.getElementById(id);

  function setSaved(flag){
    const el = $("saveStatus");
    el.textContent = flag ? "â— Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ" : "â— Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·â€¦";
    el.style.color = flag ? "var(--muted)" : "var(--warn)";
  }
  function autosave(){
    setSaved(false);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    setTimeout(()=>setSaved(true), 120);
  }
  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const s = JSON.parse(raw);
      if(s && s.zones) state = s;
    }catch(e){}
  }

  function currentZone(){ return ZONES[state.idx]; }
  function entry(){ return state.zones[currentZone().key]; }
  function colorByKey(k){ return COLORS.find(c=>c.key===k) || null; }
  function intensityByKey(k){ return INTENSITIES.find(i=>i.key===k) || null; }

  function applyZoneTheme(){
    document.body.className = currentZone().bodyClass;
    $("zoneTitle").textContent = `Î–ÏÎ½Î·: ${currentZone().title} ${currentZone().icon}`;
    $("zoneSubtitle").textContent = `Î’Î®Î¼Î± ${state.idx+1}/4 â€” Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï‡ÏÏÎ¼Î±, Ï€ÏŒÏƒÎ¿ ÎºÎ±Î¹ Î±Ï€Î¬Î½Ï„Î·ÏƒÎµ 3 ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚.`;
    $("pillZone").textContent = `${currentZone().icon} ${currentZone().title}`;
    $("pillStep").textContent = `${state.idx+1}/4`;
  }

  // ---------- PIE interaction ----------
  function pickColorFromPieClick(ev){
    const pie = ev.currentTarget;
    const rect = pie.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const x = ev.clientX - cx;
    const y = ev.clientY - cy;

    let angle = Math.atan2(y, x) * (180/Math.PI);
    angle = (angle + 360 + 90) % 360;
    const idx = Math.floor(angle / 45) % 8;

    const map = ["red","blue","yellow","green","black","white","purple","brown"];
    entry().colorKey = map[idx];
    autosave();
    renderAllToPie(); // add immediately into pie
  }

  // ---------- Build kid-friendly choices ----------
  function buildIntensity(){
    const wrap = $("intensityRow");
    wrap.innerHTML = "";
    INTENSITIES.forEach(i=>{
      const b = document.createElement("div");
      b.className = "emojiBtn";
      b.dataset.k = i.key;
      b.innerHTML = `<span class="emojiBig">${i.emoji}</span><span class="emojiText">${i.label}</span>`;
      b.addEventListener("click", ()=>{
        if(!entry().colorKey){
          $("statusLine").className = "warnline";
          $("statusLine").textContent = "Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï€ÏÏÏ„Î± Ï‡ÏÏÎ¼Î± ÏƒÏ„Î·Î½ Ï€Î¯Ï„Î± ğŸ™‚";
          return;
        }
        entry().intensityKey = i.key;
        autosave();
        renderAllToPie();
      });
      wrap.appendChild(b);
    });
  }

  function buildChoices(containerId, items, keyName){
    const wrap = $(containerId);
    wrap.innerHTML = "";
    items.forEach(item=>{
      const d = document.createElement("div");
      d.className = "choice";
      d.dataset.k = item.k;
      d.innerHTML = `
        <div class="swatch" style="background: rgba(255,255,255,.45); display:flex;align-items:center;justify-content:center;font-size:26px;">
          ${item.e}
        </div>
        <div>
          <div class="choiceBig">${item.t}</div>
          <div class="choiceSmall">Ï€Î¬Ï„Î·ÏƒÎ­ Ï„Î¿</div>
        </div>
      `;
      d.addEventListener("click", ()=>{
        if(!entry().colorKey){
          $("statusLine").className = "warnline";
          $("statusLine").textContent = "Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï€ÏÏÏ„Î± Ï‡ÏÏÎ¼Î± ÏƒÏ„Î·Î½ Ï€Î¯Ï„Î± ğŸ™‚";
          return;
        }
        entry()[keyName] = item.k;
        autosave();
        renderAllToPie();
      });
      wrap.appendChild(d);
    });
  }

  function highlightSelections(){
    document.querySelectorAll("#intensityRow .emojiBtn").forEach(btn=>{
      btn.classList.toggle("active", btn.dataset.k === entry().intensityKey);
    });
    document.querySelectorAll("#qFreq .choice").forEach(c=>{
      c.classList.toggle("active", c.dataset.k === entry().freqKey);
    });
    document.querySelectorAll("#qStart .choice").forEach(c=>{
      c.classList.toggle("active", c.dataset.k === entry().startKey);
    });
    document.querySelectorAll("#qTrig .choice").forEach(c=>{
      c.classList.toggle("active", c.dataset.k === entry().trigKey);
    });
  }

  // ---------- â€œEverything goes into the pieâ€ rendering ----------
  function setQuestionRing(){
    const on = "rgba(34,197,94,.85)";
    const off = "rgba(255,255,255,.22)";
    const e = entry();
    $("innerRing").style.setProperty("--q1", e.freqKey ? on : off);
    $("innerRing").style.setProperty("--q2", e.startKey ? on : off);
    $("innerRing").style.setProperty("--q3", e.trigKey ? on : off);
  }

  function setIntensityRing(){
    const e = entry();
    const i = intensityByKey(e.intensityKey);
    const fill = i ? i.fill : 0;
    const a = "rgba(90,120,255,.55)";
    $("intensityRing").style.background =
      `conic-gradient(${a} 0deg ${fill}deg, rgba(255,255,255,.00) ${fill}deg 360deg)`;
  }

  function renderCenterText(){
    const e = entry();
    const c = colorByKey(e.colorKey);

    if(!c){
      $("centerMain").textContent = "â€”";
      $("centerSub").textContent = "Î Î¬Ï„Î± Î­Î½Î± Ï‡ÏÏÎ¼Î± ÏƒÏ„Î·Î½ Ï€Î¯Ï„Î±";
      return;
    }

    const intensity = e.intensityKey ? `Î ÏŒÏƒÎ¿: ${e.intensityKey}` : "Î ÏŒÏƒÎ¿: (Î´Î¹Î¬Î»ÎµÎ¾Îµ)";
    const q1 = e.freqKey ? `Î£Ï…Ï‡Î½Î¬: ${e.freqKey}` : "Î£Ï…Ï‡Î½Î¬: â€”";
    const q2 = e.startKey ? `ÎÎµÎºÎ¯Î½Î·ÏƒÎµ: ${e.startKey}` : "ÎÎµÎºÎ¯Î½Î·ÏƒÎµ: â€”";
    const q3 = e.trigKey ? `Î‘Î¹Ï„Î¯Î±: ${e.trigKey}` : "Î‘Î¹Ï„Î¯Î±: â€”";

    $("centerMain").textContent = `${c.name}`;
    $("centerSub").textContent =
      `Î£Ï…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±: ${c.emotions}\n${intensity}\n${q1}\n${q2}\n${q3}`;
  }

  function renderProgressLine(){
    const e = entry();
    const colorOk = !!e.colorKey;
    const intOk = !!e.intensityKey;
    const qCount = [e.freqKey, e.startKey, e.trigKey].filter(Boolean).length;

    $("progressText").textContent =
      `Î§ÏÏÎ¼Î±: ${colorOk ? "â—" : "â—‹"}  â€¢  Î ÏŒÏƒÎ¿: ${intOk ? "â—" : "â—‹"}  â€¢  Î•ÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚: ${"â—".repeat(qCount)}${"â—‹".repeat(3-qCount)}`;

    const allOk = colorOk && intOk && qCount === 3;
    if(allOk){
      $("statusLine").className = "okline";
      $("statusLine").textContent = "âœ… Î¤Î­Î»ÎµÎ¹Î±! Î Î¬Ï„Î± Â«Î•Ï€ÏŒÎ¼ÎµÎ½Î¿Â» Î³Î¹Î± Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î¶ÏÎ½Î·.";
    }else{
      $("statusLine").className = "warnline";
      if(!colorOk) $("statusLine").textContent = "Î ÏÏÏ„Î± Î´Î¹Î¬Î»ÎµÎ¾Îµ Ï‡ÏÏÎ¼Î± ÏƒÏ„Î·Î½ Ï€Î¯Ï„Î± ğŸ™‚";
      else if(!intOk) $("statusLine").textContent = "Î¤ÏÏÎ± Î´Î¹Î¬Î»ÎµÎ¾Îµ Â«Ï€ÏŒÏƒÎ¿Â» ğŸ™‚";
      else $("statusLine").textContent = "ÎœÎ­Î½Î¿Ï…Î½ Î»Î¯Î³ÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ Î±ÎºÏŒÎ¼Î± ğŸ™‚";
    }

    $("btnNext").disabled = !allOk;
  }

  function renderAllToPie(){
    setQuestionRing();
    setIntensityRing();
    renderCenterText();
    highlightSelections();
    renderProgressLine();
  }

  // ---------- Navigation ----------
  function goNext(){
    if(state.idx < ZONES.length-1){
      state.idx += 1;
      autosave();
      renderZonePage();
    }else{
      alert("ÎœÏ€ÏÎ¬Î²Î¿! Î¤ÎµÎ»ÎµÎ¯Ï‰ÏƒÎµÏ‚ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¶ÏÎ½ÎµÏ‚ ğŸ‰");
    }
  }
  function goPrev(){
    if(state.idx > 0){
      state.idx -= 1;
      autosave();
      renderZonePage();
    }
  }

  // ---------- Export ----------
  function buildExportObject(){
    return {
      ÎµÏÎ³Î±Î»ÎµÎ¯Î¿: "Î§ÏÎ¿Î½Î¿Î£Ï…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î± 24",
      Î­ÎºÎ´Î¿ÏƒÎ·: "zone-wizard-1.0",
      Î¶ÏÎ½ÎµÏ‚: ZONES.map(z=>{
        const e = state.zones[z.key];
        const c = colorByKey(e.colorKey);
        return {
          Î¶ÏÎ½Î·: z.title,
          ÎµÎ¹ÎºÎ¿Î½Î¯Î´Î¹Î¿: z.icon,
          Ï‡ÏÏÎ¼Î±: c ? c.name : "",
          Ï‡ÏÏÎ¼Î±_hex: c ? c.color : "",
          ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±_Î­Î½Î½Î¿Î¹Î±: c ? c.emotions : "",
          Ï€ÏŒÏƒÎ¿: e.intensityKey || "",
          ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î±: e.freqKey || "",
          Î­Î½Î±ÏÎ¾Î·: e.startKey || "",
          Î±Î¹Ï„Î¯Î±: e.trigKey || ""
        };
      })
    };
  }

  function csvEscape(v){
    const s = (v ?? "").toString();
    if(/[",\n]/.test(s)) return `"${s.replaceAll('"','""')}"`;
    return s;
  }
  function buildCSV(){
    const header = ["Î¶ÏÎ½Î·","Ï‡ÏÏÎ¼Î±","Ï‡ÏÏÎ¼Î±_hex","ÏƒÏ…Î½Î±Î¯ÏƒÎ¸Î·Î¼Î±_Î­Î½Î½Î¿Î¹Î±","Ï€ÏŒÏƒÎ¿","ÏƒÏ…Ï‡Î½ÏŒÏ„Î·Ï„Î±","Î­Î½Î±ÏÎ¾Î·","Î±Î¹Ï„Î¯Î±"].join(",");
    const rows = ZONES.map(z=>{
      const e = state.zones[z.key];
      const c = colorByKey(e.colorKey);
      return [
        z.title,
        c ? c.name : "",
        c ? c.color : "",
        c ? c.emotions : "",
        e.intensityKey || "",
        e.freqKey || "",
        e.startKey || "",
        e.trigKey || "",
      ].map(csvEscape).join(",");
    });
    return [header, ...rows].join("\n");
  }

  function downloadFile(filename, content, mime){
    const blob = new Blob([content], {type:mime});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(a.href), 800);
  }

  function resetAll(){
    if(!confirm("Î£Î¯Î³Î¿Ï…ÏÎ± reset;")) return;
    localStorage.removeItem(STORAGE_KEY);
    state = {
      idx: 0,
      zones: Object.fromEntries(ZONES.map(z => [z.key, DEFAULT_ZONE_ENTRY()])),
    };
    autosave();
    renderZonePage();
  }

  // ---------- Render page ----------
  function renderZonePage(){
    applyZoneTheme();
    renderAllToPie();
    $("btnPrev").disabled = (state.idx === 0);
  }

  // ---------- Init ----------
  function init(){
    load();
    applyZoneTheme();

    buildIntensity();
    buildChoices("qFreq", [
      {k:"ÎºÎ¬Î¸Îµ Î¼Î­ÏÎ±", e:"ğŸ“…", t:"ÎšÎ¬Î¸Îµ Î¼Î­ÏÎ±"},
      {k:"ÏƒÏ…Ï‡Î½Î¬", e:"ğŸ”", t:"Î£Ï…Ï‡Î½Î¬"},
      {k:"Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚", e:"ğŸ™‚", t:"ÎœÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚"},
      {k:"ÏƒÏ€Î¬Î½Î¹Î±", e:"ğŸ«§", t:"Î£Ï€Î¬Î½Î¹Î±"},
    ], "freqKey");

    buildChoices("qStart", [
      {k:"Ï€ÏÎ¹Î½ Î»Î¯Î³ÎµÏ‚ Î¼Î­ÏÎµÏ‚", e:"ğŸ•’", t:"Î ÏÎ¹Î½ Î»Î¯Î³ÎµÏ‚ Î¼Î­ÏÎµÏ‚"},
      {k:"Ï€ÏÎ¹Î½ 1 Î¼Î®Î½Î±", e:"ğŸ—“ï¸", t:"Î ÏÎ¹Î½ 1 Î¼Î®Î½Î±"},
      {k:"Ï€ÏÎ¹Î½ Î¼Î®Î½ÎµÏ‚", e:"ğŸ“†", t:"Î ÏÎ¹Î½ Î¼Î®Î½ÎµÏ‚"},
      {k:"Ï€ÏÎ¹Î½ 1 Ï‡ÏÏŒÎ½Î¿+", e:"â³", t:"Î ÏÎ¹Î½ 1 Ï‡ÏÏŒÎ½Î¿+"},
    ], "startKey");

    buildChoices("qTrig", [
      {k:"Ï†Ï‰Î½Î­Ï‚", e:"ğŸ“¢", t:"Î¦Ï‰Î½Î­Ï‚"},
      {k:"Ï„ÏƒÎ±ÎºÏ‰Î¼ÏŒÏ‚", e:"ğŸ’¥", t:"Î¤ÏƒÎ±ÎºÏ‰Î¼ÏŒÏ‚"},
      {k:"Î¼ÏŒÎ½Î¿Ï‚/Î·", e:"ğŸ™", t:"ÎœÏŒÎ½Î¿Ï‚/Î·"},
      {k:"Î¼Î±Î¶Î¯/Î±Î³ÎºÎ±Î»Î¹Î¬", e:"ğŸ¤—", t:"ÎœÎ±Î¶Î¯ / Î‘Î³ÎºÎ±Î»Î¹Î¬"},
    ], "trigKey");

    $("pie").addEventListener("click", pickColorFromPieClick);
    $("btnNext").addEventListener("click", goNext);
    $("btnPrev").addEventListener("click", goPrev);

    $("btnExportJSON").addEventListener("click", ()=>{
      downloadFile("chronosynaisthima24.json", JSON.stringify(buildExportObject(), null, 2), "application/json");
    });
    $("btnExportCSV").addEventListener("click", ()=>{
      downloadFile("chronosynaisthima24.csv", buildCSV(), "text/csv;charset=utf-8");
    });
    $("btnReset").addEventListener("click", resetAll);

    setSaved(true);
    renderZonePage();
  }
  init();
</script>
</body>
</html>